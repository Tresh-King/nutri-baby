FROM node:18-alpine

WORKDIR /app

# Copy root package files
COPY package*.json ./
COPY prisma ./prisma/

# Install dependencies
RUN npm install
# Install ts-node global for running server.ts
RUN npm install -g ts-node typescript

# Copy source code
COPY api ./api
COPY lib ./lib
COPY deploy/docker/server.ts ./server.ts
COPY tsconfig.json ./

# Generate Prisma Client
RUN npx prisma generate

# Expose port
EXPOSE 3000

# Start custom server
CMD ["ts-node", "server.ts"]
